### 13.1. 今日目标
### 13.2.【理解】索引

* 索引作用：提升查询效率

* 索引的使用：

  * 查看索引    show index from 表名

  * 创建索引:   crete index 索引名 on 表名(表中的字段名(字段长度))

    > 如果字段是字符串类型，需要指定长度
    >
    > 如果字段不是字符串类型，可以不指定长度

  * 删除索引： drop index 索引名 on 表名;

*  插入10万条数据到数据库中

  > 目标：插入 100000 数据到  python_index_db 库中的 test_index 表
  > pymysql操作步骤：
  > 1、导入模块
  > 2、创建连接对象
  > 3、创建游标对象
  > 4、for循环，插入10万条数据
  > 5、提交数据
  > 6、关闭游标
  > 7、关闭连接

* 验证 索引效果

  * 开启检测     set profiling = 1;
  * 执行sql 
  * 查看每一个sql执行的时间  show profiles;
  * 添加索引
  * 执行sql
  * 查看 执行效率  show profiles;

### 13.3.【记忆】用户管理（一）

* 创建用户

  > create user '用户名'@'主机' identified by '密码'

* 授权

  * 权限：create drop select insert update...

  * 所有权限：all privileges;

  > grant 权限 on 数据库.表 to '用户名'@'主机';

  * 查询权限 show grants for '用户名'@'主机名'

* 刷新权限

  > flush privileges;

### 13.4.【记忆】用户管理（二）

* 修改用户权限

  > grant 权限 on 数据库.表 to '用户名'@‘主机’  with grant option;

* 修改用户密码

  * 知道密码，改新密码

    > alter user '用户名'@‘主机’ identified by '新密码';

  * 忘记密码，重置密码

    * 停止服务，设置跳过正常验证，设置密码为空
    * 设置正常验证模式，重启服务，用空密码登录，改成新密码

* 删除用户

  > drop user '用户名'@'主机';
  >
  > delete from user where user='' and host=''

### 13.5.【应用】爬虫实战:爬取数据并保存到数据库中

* 思路：

  > 思路：
  > 1、定义专门的函数，负责保存数据 add_film()
  > ​    1) 定义SQL 准备插入数据
  > ​    2）执行SQL语句
  >
  >
  > 2、定义专门函数，负责检测数据库中是否存在相同的数据 film_exist()
  > ​    1）定义sql 根据影片名称和地址 查询
  > ​    2）执行查询，并获取查询的记录数
  > ​    3）如果获取的记录数 > 0     return True
  > ​    4) 如果获取的记录数 = 0     return False
  >
  > 3、创建连接对象 （全局）
  > 4、创建游标对象（全局）
  > 5、关闭操作

### 13.6.【应用】爬虫实战:展示电影数据到网页中

* 思路:

  > 1、把 web服务器 返回值固定内容(day05的简单Web服务器-返回固定内容)，代码拷贝过来
  > 2、把原本固定的内容变为从数据库动态读取
  > 1）导入pymysql 模块
  > 2）连接数据库，并且查询所有的影片信息
  > 3）遍历查询的结果集，拼接响应的主体

### 13.7.【理解】闭包的概念及基本使用

* 闭包的概念：在一个外函数中定义了一个内函数，内函数里运用了外函数的临时变量，并且外函数的返回值是内函数的引用。这样就构成了一个闭包。
* 闭包构成的条件：
  * 存在函数的嵌套关系
  * 内层函数引用了外层函数的临时变量
  * 外层函数返回内层函数的引用（地址）

### 13.8.【了解】闭包中变量问题

* 内层定义了和外层同名的变量

  > 内层优先使用内层定义的变量，即是定义的变量的代码在内层的最后面

* 解决办法：当内层存在和外层同名变量，而且内层需要使用外层定义的变量，此时应该使用 

  nonlocal  关键字进行约束

### 13.9.【理解】装饰器入门

* 装饰器的作用：不修改源代码的基础上，给函数增加新的功能

* 装饰器使用：

  > 1) 存在闭包
  >
  > 2）需要装饰的函数

* 写法：

  @闭包的外层函数名

  def 待装饰的函数():

### 13.10.【应用】装饰有参数的函数

* 普通参数

  > 待装饰
  >
  > @functioin_out
  >
  > def login(num):
  >
  > 注意：
  >
  > 1）function_in(参数)
  >
  > 2）func(参数)

* 可变参数

  > 待装饰
  >
  > @functioin_out
  >
  > def login(*args, **kwargs):
  >
  > 注意：
  >
  > 1）function_in(*args, **kwargs)
  >
  > 2）func(*args, **kwargs)
  >
  > 错误用法：
  >
  > func(args,kwargs)

### 13.11.【应用】装饰有返回值的函数

* 步骤
  * 待装饰的函数必须有返回值(return)
  * 闭包的内层函数  `func(*args,**kwargs)`   改为  `return func(*args,**kwargs)`

### 13.12.【了解】主从配置
### 13.13. 总结